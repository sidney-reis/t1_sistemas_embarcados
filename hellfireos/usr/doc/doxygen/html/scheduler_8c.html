<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>HellfireOS v2.0: sys/kernel/scheduler.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HellfireOS v2.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a408b6d3a4a484720bc3ecfeac8947e3.html">sys</a></li><li class="navelem"><a class="el" href="dir_9bdce5c9978a35427bee854c3e6e999f.html">kernel</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">scheduler.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a606ec5940ea75925046ae6ebb7657800"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scheduler_8c.html#a606ec5940ea75925046ae6ebb7657800">dispatch_isr</a> (void *arg)</td></tr>
<tr class="memdesc:a606ec5940ea75925046ae6ebb7657800"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task dispatcher.  <a href="#a606ec5940ea75925046ae6ebb7657800"></a><br/></td></tr>
<tr class="memitem:a2feb8dfa22662ba4fc6a41e74f8837db"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scheduler_8c.html#a2feb8dfa22662ba4fc6a41e74f8837db">sched_rr</a> (void)</td></tr>
<tr class="memdesc:a2feb8dfa22662ba4fc6a41e74f8837db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Best effort (BE) scheduler.  <a href="#a2feb8dfa22662ba4fc6a41e74f8837db"></a><br/></td></tr>
<tr class="memitem:aa067fda22888ad77001f5d6162933449"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scheduler_8c.html#aa067fda22888ad77001f5d6162933449">sched_lottery</a> (void)</td></tr>
<tr class="memdesc:aa067fda22888ad77001f5d6162933449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Best effort (BE) scheduler.  <a href="#aa067fda22888ad77001f5d6162933449"></a><br/></td></tr>
<tr class="memitem:a7a2dc50bb1ab2a6ded651fbabfdf70e2"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scheduler_8c.html#a7a2dc50bb1ab2a6ded651fbabfdf70e2">sched_priorityrr</a> (void)</td></tr>
<tr class="memdesc:a7a2dc50bb1ab2a6ded651fbabfdf70e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Best effort (BE) scheduler.  <a href="#a7a2dc50bb1ab2a6ded651fbabfdf70e2"></a><br/></td></tr>
<tr class="memitem:a40c41b93afbdf4fd8564dbea90f163e5"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scheduler_8c.html#a40c41b93afbdf4fd8564dbea90f163e5">sched_rma</a> (void)</td></tr>
<tr class="memdesc:a40c41b93afbdf4fd8564dbea90f163e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Real time (RT) scheduler.  <a href="#a40c41b93afbdf4fd8564dbea90f163e5"></a><br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Sergio Johann Filho </dd></dl>
<dl class="section date"><dt>Date</dt><dd>February 2016</dd></dl>
<h1><a class="anchor" id="LICENSE"></a>
LICENSE</h1>
<p>This source code is licensed under the GNU General Public License, Version 2. See the file 'doc/license/gpl-2.0.txt' for more details.</p>
<h1><a class="anchor" id="DESCRIPTION"></a>
DESCRIPTION</h1>
<p>Kernel two-level scheduler and task queue management. </p>
</div><h2>Function Documentation</h2>
<a class="anchor" id="a606ec5940ea75925046ae6ebb7657800"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dispatch_isr </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task dispatcher. </p>
<p>The job of the dispatcher is simple: save the current task context on the TCB, update its state to ready and check its stack for overflow. If there are tasks to be scheduled, process the delay queue and invoke the real-time scheduler. If no RT tasks are ready to be scheduled, invoke the best effort scheduler. Update the scheduled task state to running and restore the context of the task.</p>
<p>Delayed tasks are in the delay queue, and are processed in the following way:</p>
<ul>
<li>The number of elements (tasks) in queue is counted;</li>
<li>The a task from the head of the queue is removed and its delay is decremented;<ul>
<li>If the decremented delay of a task reaches 0, it is put on RT or BE run queue;</li>
<li>It is put it back on the tail of the delay queue otherwise;</li>
</ul>
</li>
<li>Repeat until the whole queue is processed; </li>
</ul>

</div>
</div>
<a class="anchor" id="aa067fda22888ad77001f5d6162933449"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t sched_lottery </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Best effort (BE) scheduler. </p>
<dl class="section return"><dt>Returns</dt><dd>Best effort task id.</dd></dl>
<p>The algorithm is Lottery Scheduling.</p>
<ul>
<li>Take a task from the run queue, copy its entry and put it back at the tail of the run queue.</li>
<li>If the task is in the blocked state (it may be simply blocked or waiting in a semaphore) or its not the ticket, it is put back at the tail of the run queue and the next task is picked up. </li>
</ul>

</div>
</div>
<a class="anchor" id="a7a2dc50bb1ab2a6ded651fbabfdf70e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t sched_priorityrr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Best effort (BE) scheduler. </p>
<dl class="section return"><dt>Returns</dt><dd>Best effort task id.</dd></dl>
<p>The algorithm is priority based Round Robin.</p>
<ul>
<li>Take the first task and put it at the end of the run queue (to advance the queue and avoid deadlocks)</li>
<li>Perform a run in the queue, searching for the task with the highest priority (non blocked, lowest remaining priority)<ul>
<li>While we are at it, check if there is a critical task. If so, schedule it, and get out.</li>
</ul>
</li>
<li>Perform another run in the queue, updating the remaining priorities of all tasks by subtracting the priority of the task with the lowest remaining priority (task with the highest priority) from the remaining priority of all other tasks. </li>
</ul>

</div>
</div>
<a class="anchor" id="a40c41b93afbdf4fd8564dbea90f163e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t sched_rma </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Real time (RT) scheduler. </p>
<dl class="section return"><dt>Returns</dt><dd>Real time task id.</dd></dl>
<p>The scheduling algorithm is Rate Monotonic.</p>
<ul>
<li>Sort the queue of RT tasks by period;</li>
<li>Update real time information (remaining deadline and capacity) of the whole task set.</li>
<li>If the task at the head of the queue fits the requirements to be scheduled (not blocked, has jobs to execute and no task with higher priority according to RM was selected) then register the task to be scheduled. </li>
</ul>

</div>
</div>
<a class="anchor" id="a2feb8dfa22662ba4fc6a41e74f8837db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t sched_rr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Best effort (BE) scheduler. </p>
<dl class="section return"><dt>Returns</dt><dd>Best effort task id.</dd></dl>
<p>The algorithm is Round Robin.</p>
<ul>
<li>Take a task from the run queue, copy its entry and put it back at the tail of the run queue.</li>
<li>If the task is in the blocked state (it may be simply blocked or waiting in a semaphore), it is put back at the tail of the run queue and the next task is picked up.</li>
<li>So, if all tasks are blocked, at least the idle task can execute (it is never blocked, at least it is what we hope!).</li>
<li>Tasks in the blocked state are never removed from the run queue (they are ignored), although they may be in another queue waiting for a resource. </li>
</ul>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 23 2017 15:06:47 for HellfireOS v2.0 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
